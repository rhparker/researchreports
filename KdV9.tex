% \documentclass{book}

\documentclass[12pt]{article}
\usepackage[pdfborder={0 0 0.5 [3 2]}]{hyperref}%
\usepackage[left=1in,right=1in,top=1in,bottom=1in]{geometry}%
\usepackage[shortalphabetic]{amsrefs}%
\usepackage{amsmath}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{amssymb}                
\usepackage{amsmath}                
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{bbm}
\usepackage[table,xcdraw]{xcolor}
\usepackage{tikz}
\usepackage{float}
\usepackage{booktabs}
\usepackage{svg}
\usepackage{mathtools}
\usepackage{cool}
\usepackage{url}
\usepackage{graphicx,epsfig}
\usepackage{makecell}
\usepackage{array}

\def\noi{\noindent}
\def\T{{\mathbb T}}
\def\R{{\mathbb R}}
\def\N{{\mathbb N}}
\def\C{{\mathbb C}}
\def\Z{{\mathbb Z}}
\def\P{{\mathbb P}}
\def\E{{\mathbb E}}
\def\Q{\mathbb{Q}}
\def\ind{{\mathbb I}}

\graphicspath{ {images9/} }

\begin{document}

\section*{10 March 2017}
Last week's results look good; it seems like we have a method for finding eigenvalues, and they appear to be where we expect/want them to be. Now we repeat our experiment with different paramaters to see what happens, and we also try this on another system.

\subsection*{5th order KdV equation}
We use the 5th order KdV equation with speed $c = 40.9355$. As always, we start with a single pulse for a value of $c$ for which the exact solution is known, and use parameter continuation to increase $c$ to our desired value. Here we use domain size $L = 25$, i.e. interval $[-25, 25]$. For periodic BCs, continuation code was run with $N = 500$ grid points. For Fourier spectral methods, continuation code was run with $N = 128$ grid points.

\subsubsection*{Double Pulse 1}
Double Pulse 1 has two real eigenvalues which are negatives of each other. First we use finite difference methods with periodic BCs. Here is a table of the positive real eigenvalue for increasing values of $N$, the number of grid points. Although we ran the continuation code for 500 grid points, we need $N = 1000$ grid points before we see the appropriate eigenvalue picture. Here is the table of eigenvalues, found using \texttt{eigs}:
\begin{figure}[H]
\begin{tabular}{l|ll}
$N$    & Positive real eigenvalue      &  Difference      \\ \hline
  1000 &       2.8573  &             \\ 
  2000 &       3.3513  &      0.4940 \\ 
  4000 &       3.4627  &      0.1115 \\ 
  8000 &       3.4900  &      0.0272 \\ 
\end{tabular}
\end{figure}

Plotting the log of the difference versus the log of the grid size:
\begin{figure}[H]
\includegraphics[width=8.5cm]{1double1fdeigdiff}
\end{figure}

We have 2nd order convergence, as expected, so that is good. It looks like we are converging to something around 3.5. Now let's try Fourier. Since our matrices will not get too big, we can use \texttt{eig}.

\begin{figure}[H]
\begin{tabular}{l|ll}
$N$    & Positive real eigenvalue      &  Difference      \\ \hline
  128  &        3.5072  &             \\ 
  256  &        3.4990  &      0.0082      \\ 
  512  &        3.4990  &      5.4199e-07  \\ 
  1024 &        3.4990  &      1.0284e-07  \\
  2048 &        3.4990  &      8.9820e-07  \\ 
\end{tabular}
\end{figure}
To test for exponential convergence, we can plot the difference versus the log of the grid size (not shown), but if we do this we don't get a nice straight line. Sine the last three differences are the same order of magnitude, my guess is that we reach max precision quickly with Fourier methods. Fewer than 128 grid points does not produce accurate results. \\

Based on this, it looks like we can use Fourier methods with $N = 512$ as a ``true'' eigenvalue in this case. Let's try a ``true'' value of 3.4990 for the finite difference methods and see what happens. For this we use grid sizes from 1000 to 8000 in increments of 1000.

\begin{figure}[H]
\includegraphics[width=8.5cm]{1double1fdeigtrue}
\end{figure}

Again, we have 2nd order convergence, so Fourier spectral methods give us a nice estimate of the the ``true'' value within about $1e-7$ or so (looking at the differences in the Fourier table). It appears we can do this using only 512 grid points, which is really nice!\\

For reference, here are the eigenfunctions for the pair of real eigenvalues for Double Pulse 1. These use Fourier spectral methods with $N = 1024$. As expected the two eigenfunctions are reflections of each other over the y-axis.
\begin{figure}[H]
\includegraphics[width=8.5cm]{1double1fouriereigenfnplus}
\includegraphics[width=8.5cm]{1double1fouriereigenfnminus}
\end{figure}
Note that these are not symmetric about the y-axis. The eigenfunctions look the same no matter which method or grid size we use.

\subsubsection*{Double Pulse 2}
Here we do the same thing we did last time. We use an exponentially weighted space with weight $a = 0.2$ to separate the eigenvalues from the absolute spectrum. First, we use finite difference methods with periodic BCs. The eigenvalue pattern looks exactly the same as it did with $L = 100$, i.e. we have a Left Eigenvalue which appears to be converging to a nonzero value on the imaginary axis, and a Right Eigenvalue which appears to be converging to 0. The eigenfunction of the Right Eigenvalue appears to be an exponentially weighted version of the derivative of the double pulse, so that is good. Here are the eigenvalues. We use grid points from 1000 to 10000 in increments of 1000. Above 10000 or so grid points, it's hard to get good results from \texttt{fsolve}.

\begin{figure}[H]
\begin{tabular}{l|ll}
$N$    & Left eigenvalue      &  Right eigenvalue    \\ \hline
  1000 &   -0.0258 + 2.0161i  &    0.0177 + 1.8828i  \\ 
  2000 &   -0.0081 + 1.1472i  &    0.0062 + 0.9465i  \\ 
  3000 &   -0.0037 + 0.9019i  &    0.0028 + 0.6316i  \\ 
  4000 &   -0.0021 + 0.7987i  &    0.0016 + 0.4739i  \\
  5000 &   -0.0013 + 0.7461i  &    0.0010 + 0.3791i  \\ 
  6000 &   -0.0009 + 0.7160i  &    0.0007 + 0.3159i  \\ 
  7000 &   -0.0007 + 0.6973i  &    0.0005 + 0.2709i  \\ 
  8000 &   -0.0005 + 0.6848i  &    0.0004 + 0.2371i  \\ 
  9000 &   -0.0004 + 0.6762i  &    0.0003 + 0.2109i  \\
 10000 &   -0.0003 + 0.6701i  &    0.0003 + 0.1906i  \\ 
\end{tabular}
\end{figure}
First let's look at the Right Eigenvalue, which we expect to converge to 0 as the mesh size goes to 0 (number of grid points go in infinity). Plotting the log of the absolute value of the Right Eigenvalue vs the log of the mesh size, we see that this is indeed the case. We get first order convergence like we did before.

\begin{figure}[H]
\includegraphics[width=8.5cm]{1double2fdrighteigabs}
\end{figure}

Next let's look at the Left Eigenvalue. It looks like the imaginary part is converging to something like 0.670. First, check to make sure the real part is converging to 0 like before.

\begin{figure}[H]
\includegraphics[width=8.5cm]{1double2fdlefteigreal}
\end{figure}

We get 2nd order convergence of the real part of the Left Eigenvalue to 0 (as before), so this is good. Before we deal with the imaginary part, let's look at Fourier.

\begin{figure}[H]
\begin{tabular}{l|ll}
$N$    & Left eigenvalue      &  Right eigenvalue    \\ \hline
  128  &     -0.4647e-05 + 0.6430i &       3.3100e-05  +  0.0403i \\ 
  256  &      0.1733e-05 + 0.6423i &      -1.2287e-11  +  2.2605e-05i \\ 
  512  &      0.1735e-05 + 0.6423i &      -3.0773e-04  +  0i\\ 
  1024 &      0.1692e-05 + 0.6423i &      -4.0926e-09  +  5.9097e-04i\\
  2048 &      2.7662e-06 + 0.6423i &      1.9930e-06   +  0.0062i
\end{tabular}
\end{figure}

We don't get a nice convergence pattern here, most likely since we are near max precision like we were for Double Pulse 1. For the Left Eigenvalue, the imaginary part seems to rapidly converge to 0.6423. The real part is always of order of magnitude $1e-05$, but this deviation from 0 is likely due to the numerical method since the finite difference method converges nicely and since this seems to be about the order of magnitude of this method from what we saw above.\\

What we can do is use \texttt{fsolve} on the eigenvalue problem $(J -\lambda f) = 0$ ($J$ is Jacobian of problem linearized about double pulse). We set the eigenvalue to $0.6423i$ (i.e. get rid of the tiny real part), and use the eigenfunction we got as a starting point. Here is table of the max of the absolute value of the eigenvalue problem $J -\lambda f$ before and after \texttt{fsolve} for different grid sizes.

\begin{figure}[H]
\begin{tabular}{l|ll}
  $N$   &  $\max J -\lambda f$ before \texttt{fsolve}  &  $\max J -\lambda f$ after \texttt{fsolve} \\ \hline
  256   &     4.1982e-11 &   1.4055e-07   \\ 
  512   &     1.5391e-09 &   3.2847e-07   \\ 
  1024  &     5.4523e-08 &   1.8613e-07   \\
  2048  &     2.5028e-06 &   6.0373e-07   \\
\end{tabular}
\end{figure}
We see that by the time we get to 2048 grid points, the \texttt{fsolve}d eigenvector is actually better than the initial one! Even more evidence that these eigenvalues are pure imaginary. Here is a plot of the real and imaginary parts of the corresponding eigenfunction (after \texttt{fsolve}, 2048 grid points); the eigenfunctions are in the exp weighted space.
\begin{figure}[H]
\includegraphics[width=8.5cm]{1double2eigenfnreal}
\includegraphics[width=8.5cm]{1double2eigenfnimag}
\end{figure}
We can convert the eigenfunction back to the unweighted space by multiplying it by $e^{-ax}$, where $a = 0.2$ here. Here are the real and imaginary parts of the unweighted eigenfunctions.
\begin{figure}[H]
\includegraphics[width=8.5cm]{1double2eigenfnrealunweighted}
\includegraphics[width=8.5cm]{1double2eigenfnimagunweighted}
\end{figure}

\subsubsection*{Double Pulse 3}
Here we use Fourier spectral methods with 1024 grid points. We already know we have a pair of real eigenvalues ($\lambda = \pm 0.1176$), but we want to see the eigenfunctions.

\begin{figure}[H]
\includegraphics[width=8.5cm]{1double3fouriereigenfnplus}
\includegraphics[width=8.5cm]{1double3fouriereigenfnminus}
\end{figure}
The two eigenfunctions are again reflections of each other about the y-axis. They are very close to symmetric about the y-axis, but not quite. The two peaks are not the same height; for the positive eigenvalue, the left peak is higher both for Double Pulse 3 and Double Pulse 1. I'm not sure what this means, but it is consistent, so that is good.

\subsubsection*{Double Pulse 4}
Finite difference methods do not do well here (probably because the eigenvalues are too small), so we will use Fourier. Given what we learned from Double Pulse 2, this should be fine. Another advantage of Fourier is that the differentiation matrices are always small enough to use \texttt{eig} instead of \texttt{eigs}. We will focus only on the Left Eigenvalue, since that's the one we are interested in. Here is a table of the Left Eigenvalue, together with the max error of the eigenvalue problem before and after \texttt{fsolve}.

\begin{figure}[H]
\begin{tabular}{l|lll}
  $N$   & left eigenvalue &  $\max J -\lambda f$ before \texttt{fsolve}  &  $\max J -\lambda f$ after \texttt{fsolve} \\ \hline
  256   &  -1.5832e-11 + 0.0215i &  6.7141e-11  &  1.3100e-11   \\ 
  512   &   7.1199e-10 + 0.0215i &  1.3103e-09  &  7.2288e-10   \\ 
  1024  &  -1.4488e-08 + 0.0215i &  4.7470e-08  &  2.2036e-08 \\
\end{tabular}
\end{figure}

Again, for the pre-\texttt{fsolve} version, the real parts are very close to 0, and the max error decreases (for all numbers of grid points we tried) after we use \texttt{fsolve} to make the real part of the eigenvalue 0. The real and imaginary parts of the eigenfunction (after \texttt{fsolve}) are plotted below.

\begin{figure}[H]
\includegraphics[width=8.5cm]{1double4eigenfnreal}
\includegraphics[width=8.5cm]{1double4eigenfnimag}
\end{figure}
Doing exactly what we did above, here are the real and imaginary parts of the unweighted eigenfunctions.
\begin{figure}[H]
\includegraphics[width=8.5cm]{1double4eigenfnrealunweighted}
\includegraphics[width=8.5cm]{1double4eigenfnimagunweighted}
\end{figure}

\section*{10 March 2017}
\subsection*{Shallow water equation}
This is the following 5th order PDE:
\[
u_t + \partial _x\left( \frac{2}{15}u_{xxxx} - b u_{xx} + \frac{3}{2}u^2 + \frac{1}{2}u_x^2 + u u_{xx} \right) = 0
\]
As usual, we take a traveling wave solution $u = u(x + ct)$. We showed before that we can construct double pulses with eigenvalue patterns identical to that of the 5th order KdV equation. Now we repeat what we did above with this equation. We take $b = 2.5$ since Sanstede (2015) suggests that to have multipulses we need to choose $b > 2$. For this value of $b$, we have a known solution for $c = c_*(b) = 1.8$. Somewhere above $c = 10$, the eigenvalues of the eigenvalues of the linearization about the zero-solution become complex, so we run continuation code in the parameter $c$ until we reach $c = 20.4414$. \\

We then construct double pulses. For this equation, finite difference are not accurate enough, and in fact we cannot get \texttt{fsolve} to converge for $N > 5000$ or so. Thus we will use Fourier spectral methods. Given what we observed above, this is a good choice. Continuation code is run with $N = 512$ grid points and domain length $L = 15$. It looks like we need at least $N = 512$ grid points with Fourier to get good results.

\subsubsection*{Double Pulse 1}
As expected, we get two real eigenvalues which are negatives of each other.
\begin{figure}[H]
\begin{tabular}{l|ll}
$N$    & Positive real eigenvalue      &  Difference      \\ \hline
  512  &        11.3090  &        \\ 
  1024 &        11.3090  &      8.2311e-07  \\
\end{tabular}
\end{figure}
These values are close, so we did not go to higher numbers of grid points. The corresponding eigenfunctions are reflections of each other about the y-axis, as expected. They are also qualitatively similar to the eigenfunctions for Double Pulse 1 of the KdV equation.

\begin{figure}[H]
\includegraphics[width=8.5cm]{Sh1double1eigenfnplus}
\includegraphics[width=8.5cm]{Sh1double1eigenfnminus}
\end{figure}

\subsubsection*{Double Pulse 2}
As expected, if we take an exponentially weighted space ($a = 0.2$, same as for KdV, provides good separation from the absolute spectrum), we get a pair of complex conjugate eigenvalues which are approximatley on the imaginary axis, and a pair of eigenvalues near 0. The pair near 0 have eigenfunctions which look like the derivative of the double pulse, as expected, so we will ignore them for now and focus on the other pair. We only take the eigenvalue with positive imaginary part, since the two make a complex conjugate pair. As with the KdV equation, we can successfully run the eigenfunction through \texttt{fsolve} to get rid of the real part of the eigenvalue. For the \texttt{fsolve}, we are now requiring the norm of the eigenfunction to be 1 (\texttt{eig} and \texttt{eigs} output normalized eigenfunctions, so this makes sure we don't accidentally converge to the 0 function; not sure how much diffence it really makes, but certainly does not hurt).

\begin{figure}[H]
\begin{tabular}{l|lll}
  $N$   & Eigenvalue &  $\max J -\lambda f$ before \texttt{fsolve}  &  $\max J -\lambda f$ after \texttt{fsolve} \\ \hline
  512   &   4.6663e-07 +  0.1533i &   2.6353e-09  &  5.6233e-10   \\ 
  768   &   4.4082e-07 +  0.1534i &   7.1376e-08  &  4.9443e-09   \\
\end{tabular}
\end{figure}

For more grid points, it was taking \texttt{fsolve} a while to converge. Since the results look good, didn't feel the need to go to more grid points at this time.\\

The real and imaginary parts of the eigenfunction (after \texttt{fsolve}) are plotted below.
\begin{figure}[H]
\includegraphics[width=8.5cm]{Sh1double2eigenfnreal}
\includegraphics[width=8.5cm]{Sh1double2eigenfnimag}
\end{figure}
Doing exactly what we did above, here are the real and imaginary parts of the unweighted eigenfunctions.
\begin{figure}[H]
\includegraphics[width=8.5cm]{Sh1double2eigenfnrealunweighted}
\includegraphics[width=8.5cm]{Sh1double2eigenfnimagunweighted}
\end{figure}

\end{document}

